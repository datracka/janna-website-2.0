---
const GA_ID = import.meta.env.PUBLIC_GOOGLE_ANALYTICS_ID;
---

{GA_ID && (
  <>
    <!-- Load GA4 library via Partytown -->
    <script type="text/partytown" src={`https://www.googletagmanager.com/gtag/js?id=${GA_ID}`}></script>
    
    <!-- Initialize GA4 in the worker -->
    <script
      type="text/partytown"
      set:html={`
        window.dataLayer = window.dataLayer || [];
        function gtag(){ dataLayer.push(arguments); }
        gtag('js', new Date());

        // Get the ?utm_id_camerdata= param from the URL
        const qs = new URLSearchParams(location.search);
        const idCamerdata = qs.get('utm_id_camerdata');

        // Init GA without auto page_view
        gtag('config', '${GA_ID}', { anonymize_ip: true, send_page_view: false });
            
        // Fire a custom page_view with your parameter
        const pageViewParams = idCamerdata ? { utm_id_camerdata: idCamerdata } : {};
        gtag('event', 'page_view', pageViewParams);
      `}
    ></script>
  </>
)}
    